<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<p>Select a county:
    <select onchange="vis.render(this.options[this.selectedIndex].value);">
        <option value="1">Alamance</option>
        <option value="2">Alexander</option>
        <option value="3">Alleghany</option>
        <option value="4">Anson</option>
        <option value="5">Ashe</option>
        <option value="6">Avery</option>
    </select>
</p>
<svg id="svg_for_vis" style="width: 1000px; height: 1px;"></svg>
<div class="chart">
</div>
<script>
    class BarGraph {
        constructor(svg_id) {
            this.url = "myfuturenc.csv";
            this.svg_id = svg_id;

            this.loadAndPrepare();
        }
        loadAndPrepare() {
            d3.csv(this.url, d => {
                return {
                    american_indian_pub_students: d.american_indian_pub_students,
                    asian_pacific_islander_pub_students: d.asian_pacific_islander_pub_students,
                    black_pub_students: d.black_pub_students,
                    hispanic_pub_students: d.hispanic_pub_students,
                    multiracial_pub_students: d.multiracial_pub_students,
                    white_pub_students: d.white_pub_students,
                    K13_Students_Traditional_Schools: +d.K13_Students_Traditional_Schools,
                    Geographic_Type: d.Geographic_Type,
                    Name: d.Name
                }
            }).then(data => {
                console.log(data[50].Name)
            })
            this.render()
        }

        render(county) {

            if (county == undefined) {
                county = 1;
            }
            else {
                county = +county;
            }

            console.log(county)

            let data = [
                {group:'American Indian', value:90},
                {group: 'Asian/Pacific Islander', value:20},
                {group: 'Black', value:20},
                {group: 'Hispanic', value:25},
                {group: 'Multiracial', value:5},
                {group: 'White', value:20}
            ];

            let max_value = d3.max(data, d => d.value);

            let x = d3.scaleLinear()
                .domain([0, max_value])
                .range([0, 1500]);

            // Select the chart div which will be the container for the new bar chart
            let chart = d3.select(".chart");

            chart.selectAll("div")
                .data(data).join("div")
                .style("background", "steelblue")
                .style("color", "white")
                .style("text-align", "right")
                .style("font", "10px san-serif")
                .style("padding", "10px")
                .style("margin", "1px")
                .style("width", d => x(d.value)+"px")
                .text((d,i) => data[i].group);

            console.log(data[0].value)
        }
    }

    let vis = new BarGraph("svg_for_vis");

</script>
</body>